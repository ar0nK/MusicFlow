<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Értékelések</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .rating-star {
            color: #ddd;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        .rating-star.filled {
            color: #ffc107;
        }
        .rating-star:hover,
        .rating-star.hovered {
            color: #ff9800;
        }
    </style>
</head>
<body>
<div class="container mt-5 mb-5">
    <h1 class="mb-4">Értékelések</h1>
    <div id="ratingsSection">
        <h3 class="fs-4 mb-3">Értékelések</h3>
        <div id="ratingsList"></div>
        <hr>
        <h4 class="fs-5 mb-2">Új értékelés beküldése</h4>
        <form id="ratingForm" autocomplete="off">
            <div class="mb-2">
                <span id="starRating">
                    <!-- Csillagok ide generálódnak -->
                </span>
            </div>
            <div class="mb-2">
                <input type="text" id="ratingName" class="form-control" placeholder="Név (opcionális)">
            </div>
            <div class="mb-2">
                <textarea id="ratingComment" class="form-control" rows="2" placeholder="Írd meg a véleményed..."></textarea>
            </div>
            <button type="submit" class="btn btn-success">Értékelés beküldése</button>
        </form>
    </div>
</div>

<script>
/**
 * Egyedi kulcs termékhez, vagy fallback "demo" kulcs (ha nem kapcsolódik termékhez)
 * Ha termékhez akarod kapcsolni, cseréld le a getRatingsKey() logikáját!
 */
function getRatingsKey() {
    // Pl. ha localStorage-ban van 'kivalasztottTermekID', használd azt:
    // const id = localStorage.getItem("kivalasztottTermekID") || "demo";
    // return "ratings_" + id;
    return "ratings_demo";
}

const ratingsList = document.getElementById("ratingsList");
const ratingForm = document.getElementById("ratingForm");
const starRating = document.getElementById("starRating");
const ratingName = document.getElementById("ratingName");
const ratingComment = document.getElementById("ratingComment");

let selectedStars = 0;
let hoveredStars = 0;

// Csillagok megjelenítése
function renderStars() {
    starRating.innerHTML = "";
    for (let i = 1; i <= 5; i++) {
        const star = document.createElement("span");
        star.className = "rating-star" +
            ((i <= (hoveredStars || selectedStars)) ? " filled" : "");
        star.innerHTML = "&#9733;";
        star.addEventListener("mouseenter", () => {
            hoveredStars = i;
            renderStars();
        });
        star.addEventListener("mouseleave", () => {
            hoveredStars = 0;
            renderStars();
        });
        star.addEventListener("click", () => {
            selectedStars = i;
            renderStars();
        });
        starRating.appendChild(star);
    }
}
renderStars();

// Értékelések betöltése
function loadRatings() {
    const ratings = JSON.parse(localStorage.getItem(getRatingsKey()) || "[]");
    ratingsList.innerHTML = ratings.length === 0
        ? "<p>Még nincsenek értékelések.</p>"
        : ratings.map(r =>
            `<div class="mb-3 p-2 border rounded bg-light">
                <strong style="color:#ffc107;">${"★".repeat(r.stars)}${"☆".repeat(5-r.stars)}</strong>
                <span class="ms-2">${r.name ? r.name : "Vendég"}</span>
                <p class="mb-0 mt-1">${r.comment.replace(/</g,"&lt;")}</p>
                <small class="text-muted">${new Date(r.timestamp).toLocaleString("hu-HU")}</small>
            </div>`
        ).join("");
}
loadRatings();

// Beküldés kezelése
ratingForm.addEventListener("submit", function(e) {
    e.preventDefault();
    if (selectedStars === 0) {
        alert("Kérlek adj meg csillagos értékelést!");
        return;
    }
    const rating = {
        stars: selectedStars,
        name: ratingName.value.trim(),
        comment: ratingComment.value.trim(),
        timestamp: Date.now()
    };
    const ratings = JSON.parse(localStorage.getItem(getRatingsKey()) || "[]");
    ratings.unshift(rating);
    localStorage.setItem(getRatingsKey(), JSON.stringify(ratings));
    loadRatings();
    selectedStars = 0;
    ratingName.value = "";
    ratingComment.value = "";
    renderStars();
    alert("Köszönjük az értékelést!");
});
</script>
</body>
</html>